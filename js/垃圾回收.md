# V8 垃圾回收

主要是基于分代式垃圾回收机制。
V8 内存分为新生代和老生代两代。

新生代为存活时间较短对象，老生代中为存活时间较长的对象。

## 新生代

新生代主要通过 scavenge 算法，在具体实现通过采用 cheney.cheney 是一种采用复制的方法实现的垃圾回收算法。

它将内存一份为二，每个空间叫 semispace。一个处于使用，一个处于闲置。使用的叫 from，闲置的为 to。

先全部进 from，存活的赋值到 to，非存活的被释放，然后互换位置，再次进行回收，发现被回收过的直接到老生代，或者 to 的空间使用超过 25%。
缺点是只能使用堆内存的一半，是一个空间换时间的办法。

## 老生代

主要用 Mark-sweep 和 Mark-compact.

Mark-sweep 是编辑清除，标记需要释放的对象，然后清除。但是清除完后内存不连续，然后用 Mark-compact,将活着的对象移动到一半，移动完后，直接清理边界外的内存。V8 后续还引入了延迟处理，增量处理，引入增量标记处理。

因为一旦执行垃圾回收算法会暂停当前脚本，然后执行完垃圾算法后在恢复脚本，这个行为叫做全停顿（stop-the-world）。所以引入增量标记处理，将老生代进行切片标记，先找标记，然后在一起处理，同时并发标记(最新技术):不阻塞 js 执行。
